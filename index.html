<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wellness Tracker Final</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Montserrat:wght@400;500;600&display=swap');

        :root {
            --bg: #fffcfc;
            --card: #ffffff;
            --primary: #cfa4a4;
            --primary-soft: #efe4e4;
            --accent: #b08585;
            --text: #6b5b5b;
            --text-light: #a89999;
            --danger: #e57373;
            --success: #a4cfa4;
            --border-radius: 16px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            font-family: 'Montserrat', 'Gowun Dodum', sans-serif;
            background-color: transparent;
            color: var(--text);
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 100%;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            background: var(--card);
        }

        /* --- Header --- */
        header {
            display: flex; justify-content: space-between; align-items: flex-end;
            padding-bottom: 10px; border-bottom: 1px solid var(--primary-soft);
        }
        .header-left h1 { font-size: 1.2rem; font-weight: 600; margin: 0; color: var(--accent); letter-spacing: -0.5px; }
        .date { font-size: 0.8rem; color: var(--text-light); }
        .settings-btn { background: none; border: none; cursor: pointer; color: var(--text-light); padding: 4px; transition: 0.3s; }
        .settings-btn:hover { color: var(--accent); transform: rotate(30deg); }
        .settings-btn.active { color: var(--accent); transform: rotate(180deg); }
        .edit-notice { font-size: 0.75rem; color: var(--accent); text-align: center; background: var(--primary-soft); padding: 4px; border-radius: 4px; display: none; margin-top: -10px; }
        body.editing .edit-notice { display: block; }

        /* --- Section & Icons --- */
        .section { display: flex; flex-direction: column; gap: 0.8rem; }
        .label { font-size: 0.85rem; font-weight: 600; color: var(--text); display: flex; align-items: center; gap: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
        .icon { width: 18px; height: 18px; stroke: var(--text); stroke-width: 2; fill: none; stroke-linecap: round; stroke-linejoin: round; }
        .label .icon { stroke: var(--primary); width: 16px; height: 16px; }

        /* --- Mood --- */
        .mood-container { display: flex; justify-content: space-between; background: var(--primary-soft); padding: 10px; border-radius: var(--border-radius); }
        .mood-btn { background: none; border: none; cursor: pointer; padding: 4px; opacity: 0.5; transition: 0.2s; }
        .mood-btn svg { width: 28px; height: 28px; stroke: var(--text); }
        .mood-btn.active { opacity: 1; transform: scale(1.15); }
        .mood-btn.active svg { stroke: var(--accent); fill: rgba(255,255,255,0.5); }

        /* --- Energy --- */
        .battery-container { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .battery-shell { width: 100%; height: 36px; border: 2px solid var(--primary-soft); border-radius: 10px; padding: 4px; position: relative; display: flex; align-items: center; gap: 4px; }
        .battery-shell::after { content: ''; position: absolute; right: -6px; top: 10px; bottom: 10px; width: 4px; background: var(--primary-soft); border-radius: 0 4px 4px 0; }
        .battery-level { flex: 1; height: 100%; background: var(--primary-soft); border-radius: 4px; transition: background 0.3s ease; }
        .battery-container[data-level="1"] .battery-level:nth-child(1) { background: var(--danger); }
        .battery-container[data-level="2"] .battery-level:nth-child(-n+2) { background: #ffb74d; }
        .battery-container[data-level="3"] .battery-level:nth-child(-n+3) { background: #ffd54f; }
        .battery-container[data-level="4"] .battery-level:nth-child(-n+4) { background: #aed581; }
        .battery-container[data-level="5"] .battery-level:nth-child(-n+5) { background: var(--success); }
        .energy-text { font-size: 0.8rem; font-weight: 600; color: var(--accent); min-width: 40px; text-align: right; }

        /* --- Sleep --- */
        .sleep-wrapper { display: flex; align-items: center; gap: 12px; }
        input[type=range] { flex: 1; -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 6px; background: var(--primary-soft); border-radius: 10px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: var(--primary); margin-top: -6px; cursor: pointer; transition: 0.2s; }
        .sleep-value { font-size: 0.9rem; font-weight: 600; color: var(--accent); min-width: 50px; text-align: right; }

        /* --- MEALS (New Section Style) --- */
        .meal-list { display: flex; flex-direction: column; gap: 10px; }
        .meal-row { display: flex; align-items: center; gap: 12px; }
        .meal-icon { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; color: var(--text-light); }
        .meal-icon svg { width: 18px; height: 18px; stroke: var(--primary); stroke-width: 1.5; }
        .meal-input {
            flex: 1; border: none; border-bottom: 1px solid var(--primary-soft);
            background: transparent; padding: 6px 0; font-family: inherit; font-size: 0.85rem; color: var(--text);
            outline: none; transition: border-color 0.2s;
        }
        .meal-input:focus { border-bottom-color: var(--accent); }
        .meal-input::placeholder { color: #e0d4d4; }

        /* --- Water & Vitamin --- */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .tracker-box { display: flex; gap: 5px; flex-wrap: wrap; }
        .drop-btn, .pill-btn { background: none; border: none; cursor: pointer; padding: 0; opacity: 0.3; transition: 0.2s; }
        .drop-btn svg, .pill-btn svg { stroke: var(--primary); fill: none; width: 20px; height: 20px; }
        .drop-btn.active, .pill-btn.active { opacity: 1; transform: scale(1.1); }
        .drop-btn.active svg, .pill-btn.active svg { fill: var(--primary); }

        /* --- Dynamic Lists --- */
        .chip-container { display: flex; gap: 8px; flex-wrap: wrap; }
        .chip { padding: 6px 14px; border: 1px solid var(--primary-soft); border-radius: 20px; font-size: 0.8rem; cursor: pointer; color: var(--text-light); background: transparent; transition: 0.2s; display: flex; align-items: center; gap: 6px; }
        .chip:hover { border-color: var(--primary); }
        .chip.active { background: var(--primary); color: white; border-color: var(--primary); font-weight: 500; }
        .chip-del { display: none; width: 14px; height: 14px; background: #fff; color: var(--danger); border-radius: 50%; font-size: 10px; line-height: 14px; text-align: center; }
        body.editing .chip { border-style: dashed; border-color: var(--accent); color: var(--text); background: #fff !important; }
        body.editing .chip-del { display: inline-block; }
        .add-input-group { display: none; gap: 8px; margin-top: 4px; }
        body.editing .add-input-group { display: flex; }
        .add-input { flex: 1; border: none; border-bottom: 1px solid var(--text-light); background: transparent; padding: 4px; font-family: inherit; font-size: 0.85rem; outline: none; }
        .add-btn { background: var(--primary); color: white; border: none; border-radius: 4px; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* --- Routine --- */
        .habit-list { display: flex; flex-direction: column; gap: 8px; }
        .habit-item { display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 0.9rem; color: var(--text); padding: 4px 0; }
        .custom-checkbox { width: 18px; height: 18px; border: 2px solid var(--primary); border-radius: 4px; display: flex; align-items: center; justify-content: center; transition: 0.2s; flex-shrink: 0; }
        .custom-checkbox svg { width: 14px; height: 14px; stroke: white; opacity: 0; transition: 0.2s; }
        .habit-item.active .custom-checkbox { background: var(--primary); }
        .habit-item.active .custom-checkbox svg { opacity: 1; }
        .habit-item.active span { color: var(--text-light); text-decoration: line-through; }
        .habit-del { margin-left: auto; color: var(--danger); opacity: 0; pointer-events: none; background: none; border: none; cursor: pointer; }
        .habit-del svg { width: 16px; height: 16px; stroke: var(--danger); }
        body.editing .habit-item { border-bottom: 1px dashed var(--primary-soft); }
        body.editing .habit-del { opacity: 1; pointer-events: auto; }
        body.editing .habit-item span { text-decoration: none !important; color: var(--text) !important; }

        /* --- Note --- */
        textarea { width: 100%; height: 70px; border: 1px solid var(--primary-soft); background: #fafafa; border-radius: 12px; padding: 12px; font-family: inherit; font-size: 0.9rem; resize: none; outline: none; color: var(--text); }
        textarea:focus { border-color: var(--primary); background: white; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="header-left">
            <h1>WELLNESS LOG</h1>
            <div class="date" id="dateDisplay">Loading...</div>
        </div>
        <button class="settings-btn" onclick="toggleEditMode()">
            <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        </button>
    </header>
    <div class="edit-notice">편집 모드: 항목 수정/삭제/추가 가능</div>

    <div class="section">
        <div class="label">
            <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>MOOD
        </div>
        <div class="mood-container">
             <button class="mood-btn" onclick="setMood(0)"><svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M16 9l-2 2"></path><path d="M14 9l2 2"></path><path d="M10 9l-2 2"></path><path d="M8 9l2 2"></path><path d="M16 17c-2-2-6-2-8 0"></path></svg></button>
            <button class="mood-btn" onclick="setMood(1)"><svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="8" y1="15" x2="16" y2="15"></line><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg></button>
            <button class="mood-btn" onclick="setMood(2)"><svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg></button>
            <button class="mood-btn" onclick="setMood(3)"><svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><path d="M9 9l.01 0"></path><path d="M15 9l.01 0"></path><path d="M16 9c0-.5-.5-1-1-1s-1 .5-1 1"></path><path d="M10 9c0-.5-.5-1-1-1s-1 .5-1 1"></path></svg></button>
            <button class="mood-btn" onclick="setMood(4)"><svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><path d="M9 9L10 9"></path><path d="M14 9L15 9"></path><path d="M7 8c1.5 0 2 1.5 2 1.5"></path><path d="M17 8c-1.5 0-2 1.5-2 1.5"></path></svg></button>
        </div>
    </div>

    <div class="grid-2">
        <div class="section">
            <div class="label"><svg class="icon" viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M13 2L11 7h4L13 12"></path></svg>ENERGY</div>
            <div class="battery-container" id="energyBattery" onclick="toggleEnergy()" data-level="3">
                <div class="battery-shell">
                    <div class="battery-level"></div><div class="battery-level"></div><div class="battery-level"></div><div class="battery-level"></div><div class="battery-level"></div>
                </div>
            </div>
        </div>
        <div class="section">
            <div class="label"><svg class="icon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>SLEEP</div>
            <div class="sleep-wrapper">
                <input type="range" min="0" max="12" step="0.5" id="sleepRange" oninput="updateSleep(this.value)">
                <div class="sleep-value"><span id="sleepVal">7</span>h</div>
            </div>
        </div>
    </div>

    <div class="section">
        <div class="label">
            <svg class="icon" viewBox="0 0 24 24"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg>
            MEALS
        </div>
        <div class="meal-list">
            <div class="meal-row">
                <div class="meal-icon" title="Morning"><svg viewBox="0 0 24 24"><path d="M12 2v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="M20 12h2"></path><path d="m19.07 4.93-1.41 1.41"></path><path d="M15.91 11.63c1.23.63 2.09 1.92 2.09 3.37 0 2.21-1.79 4-4 4s-4-1.79-4-4c0-1.45.86-2.74 2.09-3.37"></path><path d="M9 12H7l-2 3h5"></path><path d="M12 12v-2"></path></svg></div>
                <input type="text" class="meal-input" id="meal-b" placeholder="Breakfast" oninput="saveMeals()">
            </div>
            <div class="meal-row">
                <div class="meal-icon" title="Lunch"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><path d="M12 1v2"></path><path d="M12 21v2"></path><path d="M4.22 4.22l1.42 1.42"></path><path d="M18.36 18.36l1.42 1.42"></path><path d="M1 12h2"></path><path d="M21 12h2"></path><path d="M4.22 19.78l1.42-1.42"></path><path d="M18.36 5.64l1.42-1.42"></path></svg></div>
                <input type="text" class="meal-input" id="meal-l" placeholder="Lunch" oninput="saveMeals()">
            </div>
            <div class="meal-row">
                <div class="meal-icon" title="Dinner"><svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></div>
                <input type="text" class="meal-input" id="meal-d" placeholder="Dinner" oninput="saveMeals()">
            </div>
            <div class="meal-row">
                <div class="meal-icon" title="Snack"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M7 9a4.5 4.5 0 1 0 10 0"></path></svg></div>
                <input type="text" class="meal-input" id="meal-s" placeholder="Snack" oninput="saveMeals()">
            </div>
        </div>
    </div>

    <div class="grid-2">
        <div class="section">
            <div class="label"><svg class="icon" viewBox="0 0 24 24"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path></svg>WATER</div>
            <div class="tracker-box" id="waterContainer"></div>
        </div>
        <div class="section">
            <div class="label"><svg class="icon" viewBox="0 0 24 24"><rect x="2" y="6" width="20" height="12" rx="6"></rect></svg>VITAMIN</div>
            <div class="tracker-box" id="vitaminContainer"></div>
        </div>
    </div>

    <div class="section">
        <div class="label">
            <svg class="icon" viewBox="0 0 24 24"><path d="M18 2l3 3-3 3"></path><path d="M2 22l3-3 3 3"></path><path d="M10 6h4"></path><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2v20"></path></svg>MOVEMENT
        </div>
        <div class="chip-container" id="movementList"></div>
        <div class="add-input-group">
            <input type="text" class="add-input" id="newMoveInput" placeholder="운동 추가">
            <button class="add-btn" onclick="addItem('move')">+</button>
        </div>
    </div>

    <div class="section">
        <div class="label">
            <svg class="icon" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>ROUTINE
        </div>
        <div class="habit-list" id="habitList"></div>
        <div class="add-input-group">
            <input type="text" class="add-input" id="newHabitInput" placeholder="루틴 추가">
            <button class="add-btn" onclick="addItem('habit')">+</button>
        </div>
    </div>

    <div class="section">
        <div class="label"><svg class="icon" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>NOTE</div>
        <textarea id="noteInput" placeholder="오늘 하루를 마무리하며..."></textarea>
    </div>
</div>

<script>
    const today = new Date();
    // 날짜별 키 생성 (오늘 날짜에만 데이터 저장/로드)
    const dateKey = `wellness_meals_${today.toISOString().split('T')[0]}`;
    // 설정값은 날짜 상관없이 유지
    const settingsKey = `wellness_config_v2`;

    document.getElementById('dateDisplay').innerText = today.toLocaleDateString('en-US', { month: 'short', day: 'numeric', weekday: 'short' });

    // 1. 설정 불러오기 (항목 리스트)
    let config = JSON.parse(localStorage.getItem(settingsKey)) || {
        moveItems: ["Stretching", "Walk", "Yoga"],
        habitItems: ["Skin Care", "Reading", "No Sugar"]
    };

    // 2. 오늘 데이터 불러오기 (없으면 초기화)
    let dailyData = JSON.parse(localStorage.getItem(dateKey)) || {
        mood: null, 
        energy: 3, 
        sleep: 7, 
        meals: { b: "", l: "", d: "", s: "" }, // 아침,점심,저녁,간식
        water: 0, 
        vitamin: 0,
        moveDone: [], 
        habitDone: [], 
        note: ""
    };

    function saveConfig() { localStorage.setItem(settingsKey, JSON.stringify(config)); }
    function saveDaily() { localStorage.setItem(dateKey, JSON.stringify(dailyData)); }

    // --- Meals Logic ---
    const mealInputs = {
        b: document.getElementById('meal-b'),
        l: document.getElementById('meal-l'),
        d: document.getElementById('meal-d'),
        s: document.getElementById('meal-s')
    };
    
    // Init Meals
    for(const [key, el] of Object.entries(mealInputs)) {
        el.value = dailyData.meals[key] || "";
    }

    function saveMeals() {
        dailyData.meals.b = mealInputs.b.value;
        dailyData.meals.l = mealInputs.l.value;
        dailyData.meals.d = mealInputs.d.value;
        dailyData.meals.s = mealInputs.s.value;
        saveDaily();
    }

    // --- Edit Logic (항목 추가/삭제) ---
    let isEditing = false;
    function toggleEditMode() {
        isEditing = !isEditing;
        document.body.classList.toggle('editing', isEditing);
        document.querySelector('.settings-btn').classList.toggle('active', isEditing);
        renderMovement(); renderHabits();
    }

    function addItem(type) {
        const input = document.getElementById(type === 'move' ? 'newMoveInput' : 'newHabitInput');
        if(!input.value.trim()) return;
        if(type === 'move') config.moveItems.push(input.value.trim());
        else config.habitItems.push(input.value.trim());
        saveConfig(); input.value = '';
        type === 'move' ? renderMovement() : renderHabits();
    }
    function deleteItem(type, name) {
        if(type === 'move') config.moveItems = config.moveItems.filter(i => i !== name);
        else config.habitItems = config.habitItems.filter(i => i !== name);
        saveConfig(); type === 'move' ? renderMovement() : renderHabits();
    }
    function editItem(type, oldName) {
        if(!isEditing) return;
        const newName = prompt("수정할 이름:", oldName);
        if(newName && newName !== oldName) {
            if(type === 'move') {
                config.moveItems[config.moveItems.indexOf(oldName)] = newName;
                let idx = dailyData.moveDone.indexOf(oldName); if(idx!==-1) dailyData.moveDone[idx] = newName;
            } else {
                config.habitItems[config.habitItems.indexOf(oldName)] = newName;
                let idx = dailyData.habitDone.indexOf(oldName); if(idx!==-1) dailyData.habitDone[idx] = newName;
            }
            saveConfig(); saveDaily(); type === 'move' ? renderMovement() : renderHabits();
        }
    }

    // --- Render & Toggles ---
    function renderMovement() {
        const c = document.getElementById('movementList'); c.innerHTML = '';
        config.moveItems.forEach(item => {
            const active = dailyData.moveDone.includes(item);
            const d = document.createElement('div'); d.className = `chip ${active?'active':''}`;
            d.innerHTML = `<span>${item}</span><span class="chip-del" onclick="event.stopPropagation();deleteItem('move','${item}')">✕</span>`;
            d.onclick = () => { if(isEditing) editItem('move', item); else { active ? dailyData.moveDone = dailyData.moveDone.filter(i=>i!==item) : dailyData.moveDone.push(item); saveDaily(); renderMovement(); }};
            c.appendChild(d);
        });
    }
    function renderHabits() {
        const c = document.getElementById('habitList'); c.innerHTML = '';
        config.habitItems.forEach(item => {
            const active = dailyData.habitDone.includes(item);
            const d = document.createElement('div'); d.className = `habit-item ${active?'active':''}`;
            d.innerHTML = `<div class="custom-checkbox"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span>${item}</span><button class="habit-del" onclick="event.stopPropagation();deleteItem('habit','${item}')"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>`;
            d.onclick = () => { if(isEditing) editItem('habit', item); else { active ? dailyData.habitDone = dailyData.habitDone.filter(i=>i!==item) : dailyData.habitDone.push(item); saveDaily(); renderHabits(); }};
            c.appendChild(d);
        });
    }

    // --- Basic Functions ---
    const moodBtns = document.querySelectorAll('.mood-btn');
    function setMood(i) { dailyData.mood = i; updateMood(); saveDaily(); }
    function updateMood() { moodBtns.forEach((b,i)=>b.classList.toggle('active', i===dailyData.mood)); }
    
    const energyContainer = document.getElementById('energyBattery');
    function toggleEnergy() { dailyData.energy = (dailyData.energy % 5) + 1; updateEnergy(); saveDaily(); }
    function updateEnergy() { energyContainer.setAttribute('data-level', dailyData.energy); }

    const sleepR = document.getElementById('sleepRange'); const sleepV = document.getElementById('sleepVal');
    function updateSleep(v) { dailyData.sleep = v; sleepV.innerText = v; saveDaily(); }

    const wCon = document.getElementById('waterContainer'); const vCon = document.getElementById('vitaminContainer');
    const wSvg = '<svg viewBox="0 0 24 24"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path></svg>';
    const pSvg = '<svg viewBox="0 0 24 24"><rect x="2" y="6" width="20" height="12" rx="6"></rect><line x1="12" y1="6" x2="12" y2="18"></line></svg>';
    for(let i=0;i<6;i++){ const b=document.createElement('button'); b.className='drop-btn'; b.innerHTML=wSvg; b.onclick=()=>{ dailyData.water=(dailyData.water===i+1)?i:i+1; updateWater(); saveDaily(); }; wCon.appendChild(b); }
    function updateWater(){ document.querySelectorAll('.drop-btn').forEach((b,i)=>b.classList.toggle('active', i<dailyData.water)); }
    for(let i=0;i<3;i++){ const b=document.createElement('button'); b.className='pill-btn'; b.innerHTML=pSvg; b.onclick=()=>{ dailyData.vitamin=(dailyData.vitamin===i+1)?i:i+1; updateVit(); saveDaily(); }; vCon.appendChild(b); }
    function updateVit(){ document.querySelectorAll('.pill-btn').forEach((b,i)=>b.classList.toggle('active', i<dailyData.vitamin)); }

    const note = document.getElementById('noteInput');
    note.addEventListener('input', (e)=>{ dailyData.note=e.target.value; saveDaily(); });

    // Init Load
    updateMood(); updateEnergy(); sleepR.value=dailyData.sleep; sleepV.innerText=dailyData.sleep;
    updateWater(); updateVit(); renderMovement(); renderHabits(); note.value=dailyData.note;

</script>
</body>
</html>
